(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/bbs/sendPost/sendPost"],{"04bf":function(e,n,o){"use strict";var t=o("6516"),i=o.n(t);i.a},"3f43":function(e,n,o){"use strict";o.r(n);var t=o("6be7"),i=o.n(t);for(var l in t)["default"].indexOf(l)<0&&function(e){o.d(n,e,(function(){return t[e]}))}(l);n["default"]=i.a},"610d":function(e,n,o){"use strict";o.d(n,"b",(function(){return i})),o.d(n,"c",(function(){return l})),o.d(n,"a",(function(){return t}));var t={"u-Form":function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u--form/u--form")]).then(o.bind(null,"a28e"))},uFormItem:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(o.bind(null,"6ebe"))},"u-Input":function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u--input/u--input")]).then(o.bind(null,"5ffc"))},"u-Textarea":function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u--textarea/u--textarea")]).then(o.bind(null,"b64d"))},uCellGroup:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-cell-group/u-cell-group")]).then(o.bind(null,"3640"))},uCell:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-cell/u-cell")]).then(o.bind(null,"4ec6"))},uPicker:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-picker/u-picker")]).then(o.bind(null,"c5cb"))},uniFilePicker:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(o.bind(null,"bbe4"))},uButton:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-button/u-button")]).then(o.bind(null,"872b"))}},i=function(){var e=this.$createElement;this._self._c},l=[]},6516:function(e,n,o){},"6be7":function(e,n,o){"use strict";(function(e){var t=o("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=t(o("2eee")),l=t(o("c973")),u={data:function(){return{imageValue:[],model1:{postInfo:{user_id:null,title:"",context:"",imgurl:null,classify:null,block:null,is_pass:null,image:null}},rules:{"postInfo.title":{required:!0,message:"需填写标题",trigger:["blur"]},"postInfo.context":{required:!0,message:"必须填写内容",trigger:["blur"]},"postInfo.classify":{required:!0,message:"必须选择一个板块",trigger:["change"]}},fileList1:[],imgUrlArr:[],pickerShow:!1,classify:[["城市","支付方式"],["成都市","德阳市","眉山市","资阳市"]],block:[["成都市","德阳市","眉山市","资阳市"],["实体卡","NFC卡","天府通APP二维码"]],pickerLoading:!1,blockChoosen:"请点击选择",loading:!1}},methods:{clearImg:function(){this.$refs.imgUP.clearFiles(),this.imgUrlArr=[]},uploadImg:function(){var n=this;return console.log(5555),new Promise((function(o){e.uploadFile({url:"http://localhost:3000/upload/upimg",filePath:n.imgUrlArr,name:"image",formData:{},success:function(e){console.log(e.data),o(e.data)}})}))},setImgUrl:function(){var e=this;return(0,l.default)(i.default.mark((function n(){var o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.uploadImg();case 2:o=n.sent,console.log(o);case 4:case"end":return n.stop()}}),n)})))()},select:function(n){this.imgUrlArr.push(n.tempFilePaths[0]),e.uploadFile({url:"http://localhost:3000/upload/upimg",filePath:this.imgUrlArr[0],name:"image",formData:{},success:function(e){console.log(e.data)}})},changePickerShow:function(){this.pickerShow=!0},changeHandler:function(n){var o=this;console.log(n);var t=n.columnIndex,i=(n.value,n.values,n.index),l=n.picker,u=void 0===l?this.$refs.uPicker:l;0===t&&(this.pickerLoading=!0,e.$u.sleep(300).then((function(){u.setColumnValues(1,o.block[i]),o.pickerLoading=!1})))},confirmPicker:function(e){console.log(e),this.blockChoosen="".concat(e.value[0],"-").concat(e.value[1]),this.model1.postInfo.classify=e.value[0],this.model1.postInfo.block=e.value[1],this.pickerShow=!1},cancelPicker:function(){this.pickerShow=!1},sendPost:function(n){"城市"===this.model1.postInfo.classify&&(this.model1.postInfo.classify=1),"支付方式"===this.model1.postInfo.classify&&(this.model1.postInfo.classify=2);var o=e.getStorageSync("user_id");e.$u.http.post("/bbs/sendPost",{user_id:o,category_id:"".concat(this.model1.postInfo.classify),title:"".concat(this.model1.postInfo.title),content:"".concat(this.model1.postInfo.context),is_pass:n,image:"".concat(this.model1.postInfo.image)}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},submit:function(){var n=this,o="".concat(this.model1.postInfo.title,",").concat(this.model1.postInfo.context);console.log(this.model1.postInfo),e.showLoading({title:"加载中"}),this.$refs.uForm.validate().then((function(t){e.$u.http.post("https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=24.5ad0345de5d7b3092ded668b39d1bc15.2592000.1684510068.282335-32035516",{text:o},{header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}}).then((function(o){console.log(o);var t=o.data.conclusion,i=null;"合规"===t?(n.model1.postInfo.is_pass=1,n.sendPost(n.model1.postInfo.is_pass),e.showModal({title:"提示",content:"发帖成功",showCancel:!1,success:function(){e.navigateTo({delta:1})}})):"疑似"===t?(n.model1.postInfo.is_pass=2,i=o.data.data[0].msg,e.showModal({title:"提示",content:"发帖内容".concat(i,",已提交至后台等待管理员审核"),showCancel:!1})):(i=o.data.data[0].msg,e.showModal({title:"提示",content:"发帖内容".concat(i,",请编辑后重新提交"),showCancel:!1})),e.hideLoading()})).catch((function(e){console.log(e)}))})).catch((function(n){e.hideLoading(),e.showModal({title:"提示",content:"请按规定填写内容",showCancel:!1})}))}},onReady:function(){this.$refs.uForm.setRules(this.rules)}};n.default=u}).call(this,o("543d")["default"])},7123:function(e,n,o){"use strict";o.r(n);var t=o("610d"),i=o("3f43");for(var l in i)["default"].indexOf(l)<0&&function(e){o.d(n,e,(function(){return i[e]}))}(l);o("04bf");var u=o("f0c5"),s=Object(u["a"])(i["default"],t["b"],t["c"],!1,null,null,null,!1,t["a"],void 0);n["default"]=s.exports},"7ec8":function(e,n,o){"use strict";(function(e,n){var t=o("4ea4");o("0ba6");t(o("66fd"));var i=t(o("7123"));e.__webpack_require_UNI_MP_PLUGIN__=o,n(i.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])}},[["7ec8","common/runtime","common/vendor"]]]);