(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/bbs/sendPost/sendPost"],{395:function(e,n,t){"use strict";(function(e,n){var o=t(4);t(26);o(t(25));var i=o(t(396));e.__webpack_require_UNI_MP_PLUGIN__=t,n(i.default)}).call(this,t(1)["default"],t(2)["createPage"])},396:function(e,n,t){"use strict";t.r(n);var o=t(397),i=t(399);for(var s in i)["default"].indexOf(s)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(s);t(401);var u,r=t(32),l=Object(r["default"])(i["default"],o["render"],o["staticRenderFns"],!1,null,null,null,!1,o["components"],u);l.options.__file="pages/bbs/sendPost/sendPost.vue",n["default"]=l.exports},397:function(e,n,t){"use strict";t.r(n);var o=t(398);t.d(n,"render",(function(){return o["render"]})),t.d(n,"staticRenderFns",(function(){return o["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return o["recyclableRender"]})),t.d(n,"components",(function(){return o["components"]}))},398:function(e,n,t){"use strict";var o;t.r(n),t.d(n,"render",(function(){return i})),t.d(n,"staticRenderFns",(function(){return u})),t.d(n,"recyclableRender",(function(){return s})),t.d(n,"components",(function(){return o}));try{o={"u-Form":function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u--form/u--form")]).then(t.bind(null,990))},uFormItem:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(t.bind(null,996))},"u-Input":function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u--input/u--input")]).then(t.bind(null,1004))},"u-Textarea":function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u--textarea/u--textarea")]).then(t.bind(null,1010))},uCellGroup:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-cell-group/u-cell-group")]).then(t.bind(null,1133))},uCell:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-cell/u-cell")]).then(t.bind(null,1141))},uPicker:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-picker/u-picker")]).then(t.bind(null,1149))},uniFilePicker:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(t.bind(null,1016))},uButton:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-button/u-button")]).then(t.bind(null,980))}}}catch(r){if(-1===r.message.indexOf("Cannot find module")||-1===r.message.indexOf(".vue"))throw r;console.error(r.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var i=function(){var e=this,n=e.$createElement;e._self._c},s=!1,u=[];i._withStripped=!0},399:function(e,n,t){"use strict";t.r(n);var o=t(400),i=t.n(o);for(var s in o)["default"].indexOf(s)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(s);n["default"]=i.a},400:function(e,n,t){"use strict";(function(e){var o=t(4);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(t(55)),s=o(t(57)),u={data:function(){return{imageValue:[],model1:{postInfo:{user_id:null,title:"",context:"",imgurl:null,classify:null,is_pass:null,image:null}},rules:{"postInfo.title":{required:!0,message:"需填写标题",trigger:["blur"]},"postInfo.context":{required:!0,message:"必须填写内容",trigger:["blur"]}},fileList1:[],imgUrlArr:[],postImgUrl:[],pickerShow:!1,classify:[],pickerLoading:!1,blockChoosen:"请点击选择",loading:!1}},methods:{getBlockList:function(){var n=this;e.$u.http.get("/bbs/getAllBlock").then((function(e){var t=e.data,o=t.map((function(e){return{name:e.name,id:e.id}}));console.log(o),n.classify[0]=o}))},clearImg:function(){this.$refs.imgUP.clearFiles(),this.imgUrlArr=[]},uploadImg:function(){var n=this;return console.log(111),new Promise((function(t){e.uploadFile({url:"http://localhost:3000/upload/upimg",filePath:n.imgUrlArr[0],name:"image",formData:{},success:function(e){t(e)}})}))},setpostUrlImg:function(){var e=this;return(0,s.default)(i.default.mark((function n(){var t,o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.uploadImg();case 2:t=n.sent,o=JSON.parse(t.data),e.postImgUrl.push(o.data[0]);case 5:case"end":return n.stop()}}),n)})))()},handleImgUrl:function(){0!==this.postImgUrl.length&&(this.model1.postInfo.image=this.postImgUrl.join(","))},select:function(e){var n=e.tempFilePaths.length;this.imgUrlArr[0]=e.tempFilePaths[n-1],this.setpostUrlImg()},changePickerShow:function(){this.pickerShow=!0},confirmPicker:function(e){this.blockChoosen=e.value[0].name,this.model1.postInfo.classify=e.value[0].id,this.pickerShow=!1},cancelPicker:function(){this.pickerShow=!1},sendPost:function(n){var t=e.getStorageSync("user_id");e.$u.http.post("/bbs/sendPost",{user_id:t,category_id:"".concat(this.model1.postInfo.classify),title:"".concat(this.model1.postInfo.title),content:"".concat(this.model1.postInfo.context),is_pass:n,image:"".concat(this.model1.postInfo.image)}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},submit:function(){var n=this;this.handleImgUrl(),e.showLoading({title:"加载中"});var t="".concat(this.model1.postInfo.title,",").concat(this.model1.postInfo.context);console.log(this.model1.postInfo),null===this.model1.postInfo.classify?(e.hideLoading(),e.showModal({title:"提示",content:"必须选择一个板块",showCancel:!1})):this.$refs.uForm.validate().then((function(o){e.$u.http.post("https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=24.5ad0345de5d7b3092ded668b39d1bc15.2592000.1684510068.282335-32035516",{text:t},{header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}}).then((function(t){console.log(t);var o=t.data.conclusion,i=null;"合规"===o?(n.model1.postInfo.is_pass=1,n.sendPost(n.model1.postInfo.is_pass),e.showModal({title:"提示",content:"发帖成功",showCancel:!1,success:function(){e.reLaunch({url:"/pages/bbs/bbs"})}})):"疑似"===o?(n.model1.postInfo.is_pass=0,n.sendPost(n.model1.postInfo.is_pass),i=t.data.data[0].msg,e.showModal({title:"提示",content:"发帖内容".concat(i,",已提交至后台等待管理员审核"),showCancel:!1,success:function(){e.reLaunch({url:"/pages/bbs/bbs"})}})):(i=t.data.data[0].msg,e.showModal({title:"提示",content:"发帖内容".concat(i,",不允许发布，请编辑后重新提交"),showCancel:!1})),e.hideLoading()})).catch((function(e){console.log(e)}))})).catch((function(n){e.hideLoading(),console.log(n),e.showModal({title:"提示",content:"请按规定填写内容",showCancel:!1})}))}},onReady:function(){this.$refs.uForm.setRules(this.rules)},mounted:function(){this.getBlockList()}};n.default=u}).call(this,t(2)["default"])},401:function(e,n,t){"use strict";t.r(n);var o=t(402),i=t.n(o);for(var s in o)["default"].indexOf(s)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(s);n["default"]=i.a},402:function(e,n,t){}},[[395,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/bbs/sendPost/sendPost.js.map