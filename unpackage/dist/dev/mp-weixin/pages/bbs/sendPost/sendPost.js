(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/bbs/sendPost/sendPost"],{315:function(e,n,o){"use strict";(function(e,n){var t=o(4);o(26);t(o(25));var i=t(o(316));e.__webpack_require_UNI_MP_PLUGIN__=o,n(i.default)}).call(this,o(1)["default"],o(2)["createPage"])},316:function(e,n,o){"use strict";o.r(n);var t=o(317),i=o(319);for(var s in i)["default"].indexOf(s)<0&&function(e){o.d(n,e,(function(){return i[e]}))}(s);o(321);var u,r=o(32),l=Object(r["default"])(i["default"],t["render"],t["staticRenderFns"],!1,null,null,null,!1,t["components"],u);l.options.__file="pages/bbs/sendPost/sendPost.vue",n["default"]=l.exports},317:function(e,n,o){"use strict";o.r(n);var t=o(318);o.d(n,"render",(function(){return t["render"]})),o.d(n,"staticRenderFns",(function(){return t["staticRenderFns"]})),o.d(n,"recyclableRender",(function(){return t["recyclableRender"]})),o.d(n,"components",(function(){return t["components"]}))},318:function(e,n,o){"use strict";var t;o.r(n),o.d(n,"render",(function(){return i})),o.d(n,"staticRenderFns",(function(){return u})),o.d(n,"recyclableRender",(function(){return s})),o.d(n,"components",(function(){return t}));try{t={"u-Form":function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u--form/u--form")]).then(o.bind(null,511))},uFormItem:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(o.bind(null,517))},"u-Input":function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u--input/u--input")]).then(o.bind(null,525))},"u-Textarea":function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u--textarea/u--textarea")]).then(o.bind(null,531))},uCellGroup:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-cell-group/u-cell-group")]).then(o.bind(null,537))},uCell:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-cell/u-cell")]).then(o.bind(null,545))},uPicker:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-picker/u-picker")]).then(o.bind(null,553))},uniFilePicker:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(o.bind(null,561))},uButton:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-button/u-button")]).then(o.bind(null,579))}}}catch(r){if(-1===r.message.indexOf("Cannot find module")||-1===r.message.indexOf(".vue"))throw r;console.error(r.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var i=function(){var e=this,n=e.$createElement;e._self._c},s=!1,u=[];i._withStripped=!0},319:function(e,n,o){"use strict";o.r(n);var t=o(320),i=o.n(t);for(var s in t)["default"].indexOf(s)<0&&function(e){o.d(n,e,(function(){return t[e]}))}(s);n["default"]=i.a},320:function(e,n,o){"use strict";(function(e){var t=o(4);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=t(o(55)),s=t(o(57)),u={data:function(){return{imageValue:[],model1:{postInfo:{user_id:null,title:"",context:"",imgurl:null,classify:null,block:null,is_pass:null,image:null}},rules:{"postInfo.title":{required:!0,message:"需填写标题",trigger:["blur"]},"postInfo.context":{required:!0,message:"必须填写内容",trigger:["blur"]},"postInfo.classify":{required:!0,message:"必须选择一个板块",trigger:["change"]}},fileList1:[],imgUrlArr:[],postImgUrl:[],pickerShow:!1,classify:[["城市","支付方式"],["成都市","德阳市","眉山市","资阳市"]],block:[["成都市","德阳市","眉山市","资阳市"],["实体卡","NFC卡","天府通APP二维码"]],pickerLoading:!1,blockChoosen:"请点击选择",loading:!1}},methods:{clearImg:function(){this.$refs.imgUP.clearFiles(),this.imgUrlArr=[]},uploadImg:function(){var n=this;return console.log(111),new Promise((function(o){e.uploadFile({url:"http://localhost:3000/upload/upimg",filePath:n.imgUrlArr[0],name:"image",formData:{},success:function(e){o(e)}})}))},setpostUrlImg:function(){var e=this;return(0,s.default)(i.default.mark((function n(){var o,t;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.uploadImg();case 2:o=n.sent,t=JSON.parse(o.data),e.postImgUrl.push(t.data[0]);case 5:case"end":return n.stop()}}),n)})))()},handleImgUrl:function(){0!==this.postImgUrl.length&&(this.model1.postInfo.image=this.postImgUrl.join(","))},select:function(e){var n=e.tempFilePaths.length;this.imgUrlArr[0]=e.tempFilePaths[n-1],this.setpostUrlImg()},changePickerShow:function(){this.pickerShow=!0},changeHandler:function(n){var o=this;console.log(n);var t=n.columnIndex,i=(n.value,n.values,n.index),s=n.picker,u=void 0===s?this.$refs.uPicker:s;0===t&&(this.pickerLoading=!0,e.$u.sleep(300).then((function(){u.setColumnValues(1,o.block[i]),o.pickerLoading=!1})))},confirmPicker:function(e){this.blockChoosen="".concat(e.value[0],"-").concat(e.value[1]),this.model1.postInfo.classify=e.value[0],this.model1.postInfo.block=e.value[1],this.pickerShow=!1},cancelPicker:function(){this.pickerShow=!1},sendPost:function(n){"城市"===this.model1.postInfo.classify&&(this.model1.postInfo.classify=1),"支付方式"===this.model1.postInfo.classify&&(this.model1.postInfo.classify=2);var o=e.getStorageSync("user_id");e.$u.http.post("/bbs/sendPost",{user_id:o,category_id:"".concat(this.model1.postInfo.classify),title:"".concat(this.model1.postInfo.title),content:"".concat(this.model1.postInfo.context),is_pass:n,image:"".concat(this.model1.postInfo.image)}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},submit:function(){var n=this;this.handleImgUrl();var o="".concat(this.model1.postInfo.title,",").concat(this.model1.postInfo.context);console.log(this.model1.postInfo),e.showLoading({title:"加载中"}),this.$refs.uForm.validate().then((function(t){e.$u.http.post("https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=24.5ad0345de5d7b3092ded668b39d1bc15.2592000.1684510068.282335-32035516",{text:o},{header:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}}).then((function(o){console.log(o);var t=o.data.conclusion,i=null;"合规"===t?(n.model1.postInfo.is_pass=1,n.sendPost(n.model1.postInfo.is_pass),e.showModal({title:"提示",content:"发帖成功",showCancel:!1,success:function(){e.reLaunch({url:"/pages/bbs/bbs"})}})):"疑似"===t?(n.model1.postInfo.is_pass=2,n.sendPost(n.model1.postInfo.is_pass),i=o.data.data[0].msg,e.showModal({title:"提示",content:"发帖内容".concat(i,",已提交至后台等待管理员审核"),showCancel:!1,success:function(){e.reLaunch({url:"/pages/bbs/bbs"})}})):(i=o.data.data[0].msg,e.showModal({title:"提示",content:"发帖内容".concat(i,",不允许发布，请编辑后重新提交"),showCancel:!1})),e.hideLoading()})).catch((function(e){console.log(e)}))})).catch((function(n){e.hideLoading(),e.showModal({title:"提示",content:"请按规定填写内容",showCancel:!1})}))}},onReady:function(){this.$refs.uForm.setRules(this.rules)}};n.default=u}).call(this,o(2)["default"])},321:function(e,n,o){"use strict";o.r(n);var t=o(322),i=o.n(t);for(var s in t)["default"].indexOf(s)<0&&function(e){o.d(n,e,(function(){return t[e]}))}(s);n["default"]=i.a},322:function(e,n,o){}},[[315,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/bbs/sendPost/sendPost.js.map